; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.40219.01 

include listing.inc

INCLUDELIB OLDNAMES

PUBLIC	?access@MEMPOOL@@AEAAPEAPEAXPEAX@Z		; MEMPOOL::access
PUBLIC	??_C@_0BG@MKOFECCD@MEMPOOL?3?3block_create?$AA@	; `string'
PUBLIC	??_C@_0BC@NDOHMDNG@xrMemory_POOL?4cpp?$AA@	; `string'
PUBLIC	??_C@_07GJEIOLDE@0?$DN?$DNlist?$AA@		; `string'
PUBLIC	??_C@_0BF@BGCJKNBA@MEMPOOL?3?3_initialize?$AA@	; `string'
PUBLIC	??_C@_0BF@KMPPNLMJ@_element?5?$DM?5_sector?12?$AA@ ; `string'
;	COMDAT ?ignore_always@?3??block_create@MEMPOOL@@AEAAXXZ@4_NA
_BSS	SEGMENT
?ignore_always@?3??block_create@MEMPOOL@@AEAAXXZ@4_NA DB 01H DUP (?) ; `MEMPOOL::block_create'::`4'::ignore_always
_BSS	ENDS
;	COMDAT ?ignore_always@?3??_initialize@MEMPOOL@@QEAAXIII@Z@4_NA
_BSS	SEGMENT
?ignore_always@?3??_initialize@MEMPOOL@@QEAAXIII@Z@4_NA DB 01H DUP (?) ; `MEMPOOL::_initialize'::`4'::ignore_always
;	COMDAT ??_C@_0BF@KMPPNLMJ@_element?5?$DM?5_sector?12?$AA@
CONST	SEGMENT
??_C@_0BF@KMPPNLMJ@_element?5?$DM?5_sector?12?$AA@ DB '_element < _sector'
	DB	'/2', 00H					; `string'
CONST	ENDS
;	COMDAT ??_C@_0BF@BGCJKNBA@MEMPOOL?3?3_initialize?$AA@
CONST	SEGMENT
??_C@_0BF@BGCJKNBA@MEMPOOL?3?3_initialize?$AA@ DB 'MEMPOOL::_initialize', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_07GJEIOLDE@0?$DN?$DNlist?$AA@
CONST	SEGMENT
??_C@_07GJEIOLDE@0?$DN?$DNlist?$AA@ DB '0==list', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BC@NDOHMDNG@xrMemory_POOL?4cpp?$AA@
CONST	SEGMENT
??_C@_0BC@NDOHMDNG@xrMemory_POOL?4cpp?$AA@ DB 'xrMemory_POOL.cpp', 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BG@MKOFECCD@MEMPOOL?3?3block_create?$AA@
CONST	SEGMENT
??_C@_0BG@MKOFECCD@MEMPOOL?3?3block_create?$AA@ DB 'MEMPOOL::block_create'
	DB	00H						; `string'
; Function compile flags: /Ogtpy
; File c:\users\nummer\documents\github\olr-3.0\src\xray\xrcore\xrmemory_pool.h
;	COMDAT ?access@MEMPOOL@@AEAAPEAPEAXPEAX@Z
_TEXT	SEGMENT
P$ = 8
?access@MEMPOOL@@AEAAPEAPEAXPEAX@Z PROC			; MEMPOOL::access, COMDAT

; 21   : 	ICF void**			access			(void* P)	{ return (void**) ((void*)(P));	}

	mov	rax, rcx
	ret	0
?access@MEMPOOL@@AEAAPEAPEAXPEAX@Z ENDP			; MEMPOOL::access
PUBLIC	?_initialize@MEMPOOL@@QEAAXIII@Z		; MEMPOOL::_initialize
pdata	SEGMENT
$pdata$?_initialize@MEMPOOL@@QEAAXIII@Z DD imagerel $LN9
	DD	imagerel $LN9+163
	DD	imagerel $unwind$?_initialize@MEMPOOL@@QEAAXIII@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?_initialize@MEMPOOL@@QEAAXIII@Z DD 040a01H
	DD	0c340aH
	DD	07006920aH
; Function compile flags: /Ogtpy
; File c:\users\nummer\documents\github\olr-3.0\src\xray\xrcore\xrmemory_pool.cpp
xdata	ENDS
_TEXT	SEGMENT
this$ = 96
_element$ = 104
?_initialize@MEMPOOL@@QEAAXIII@Z PROC			; MEMPOOL::_initialize

; 24   : {

$LN9:
	mov	QWORD PTR [rsp+8], rbx
	push	rdi
	sub	rsp, 80					; 00000050H

; 25   : 	R_ASSERT		(_element < _sector/2);

	cmp	BYTE PTR ?ignore_always@?3??_initialize@MEMPOOL@@QEAAXIII@Z@4_NA, 0
	mov	edi, edx
	mov	rbx, rcx
	jne	SHORT $LN3@initialize
	cmp	edx, 8192				; 00002000H
	jb	SHORT $LN3@initialize
	lea	rax, OFFSET FLAT:?ignore_always@?3??_initialize@MEMPOOL@@QEAAXIII@Z@4_NA
	lea	r8, OFFSET FLAT:??_C@_0BF@KMPPNLMJ@_element?5?$DM?5_sector?12?$AA@
	lea	rdx, OFFSET FLAT:??_C@_0BB@DBHFCHNO@assertion?5failed?$AA@
	mov	QWORD PTR [rsp+64], rax
	lea	rax, OFFSET FLAT:??_C@_0BF@BGCJKNBA@MEMPOOL?3?3_initialize?$AA@
	lea	rcx, OFFSET FLAT:?Debug@@3VxrDebug@@A	; Debug
	mov	QWORD PTR [rsp+56], rax
	lea	rax, OFFSET FLAT:??_C@_0BC@NDOHMDNG@xrMemory_POOL?4cpp?$AA@
	mov	DWORD PTR [rsp+48], 25
	mov	QWORD PTR [rsp+40], rax
	xor	r9d, r9d
	mov	QWORD PTR [rsp+32], 0
	call	?backend@xrDebug@@QEAAXPEBD0000H0AEA_N@Z ; xrDebug::backend
$LN3@initialize:

; 26   : 	s_sector		= _sector;
; 27   : 	s_element		= _element;
; 28   : 	s_count			= s_sector/s_element;

	xor	edx, edx
	mov	eax, 16384				; 00004000H
	mov	DWORD PTR [rbx+8], 16384		; 00004000H
	div	edi
	mov	DWORD PTR [rbx+12], edi

; 29   : 	s_offset		= _header;
; 30   : 	list			= NULL;

	mov	QWORD PTR [rbx+32], 0
	mov	DWORD PTR [rbx+16], eax
	mov	QWORD PTR [rbx+20], 1

; 31   : 	block_count		= 0;
; 32   : }

	mov	rbx, QWORD PTR [rsp+96]
	add	rsp, 80					; 00000050H
	pop	rdi
	ret	0
?_initialize@MEMPOOL@@QEAAXIII@Z ENDP			; MEMPOOL::_initialize
_TEXT	ENDS
PUBLIC	?block_create@MEMPOOL@@AEAAXXZ			; MEMPOOL::block_create
pdata	SEGMENT
$pdata$?block_create@MEMPOOL@@AEAAXXZ DD imagerel $LN23
	DD	imagerel $LN23+280
	DD	imagerel $unwind$?block_create@MEMPOOL@@AEAAXXZ
pdata	ENDS
xdata	SEGMENT
$unwind$?block_create@MEMPOOL@@AEAAXXZ DD 060f01H
	DD	0d640fH
	DD	0c340fH
	DD	0700b920fH
; Function compile flags: /Ogtpy
xdata	ENDS
_TEXT	SEGMENT
this$ = 96
?block_create@MEMPOOL@@AEAAXXZ PROC			; MEMPOOL::block_create

; 8    : {

$LN23:
	mov	QWORD PTR [rsp+8], rbx
	mov	QWORD PTR [rsp+16], rsi
	push	rdi
	sub	rsp, 80					; 00000050H

; 9    : 	// Allocate
; 10   : 	R_ASSERT				(0==list);

	cmp	BYTE PTR ?ignore_always@?3??block_create@MEMPOOL@@AEAAXXZ@4_NA, 0
	mov	rbx, rcx
	jne	SHORT $LN6@block_crea
	cmp	QWORD PTR [rcx+32], 0
	je	SHORT $LN6@block_crea
	lea	rax, OFFSET FLAT:?ignore_always@?3??block_create@MEMPOOL@@AEAAXXZ@4_NA
	lea	r8, OFFSET FLAT:??_C@_07GJEIOLDE@0?$DN?$DNlist?$AA@
	lea	rdx, OFFSET FLAT:??_C@_0BB@DBHFCHNO@assertion?5failed?$AA@
	mov	QWORD PTR [rsp+64], rax
	lea	rax, OFFSET FLAT:??_C@_0BG@MKOFECCD@MEMPOOL?3?3block_create?$AA@
	lea	rcx, OFFSET FLAT:?Debug@@3VxrDebug@@A	; Debug
	mov	QWORD PTR [rsp+56], rax
	lea	rax, OFFSET FLAT:??_C@_0BC@NDOHMDNG@xrMemory_POOL?4cpp?$AA@
	mov	DWORD PTR [rsp+48], 10
	mov	QWORD PTR [rsp+40], rax
	xor	r9d, r9d
	mov	QWORD PTR [rsp+32], 0
	call	?backend@xrDebug@@QEAAXPEBD0000H0AEA_N@Z ; xrDebug::backend
$LN6@block_crea:

; 11   : 	list					= (u8*)		xr_aligned_offset_malloc	(s_sector,16,s_offset);

	mov	edi, DWORD PTR [rbx+20]
	mov	eax, DWORD PTR [rbx+8]
	cmp	rdi, rax
	jb	SHORT $LN13@block_crea
	test	rdi, rdi
	je	SHORT $LN13@block_crea
	lea	rax, QWORD PTR [rdi+1]
$LN13@block_crea:
	mov	rsi, rdi
	neg	rsi
	and	esi, 7
	lea	rcx, QWORD PTR [rsi+rax+23]
	call	QWORD PTR __imp_malloc
	mov	r11, rax
	test	rax, rax
	jne	SHORT $LN12@block_crea
	xor	ecx, ecx
	jmp	SHORT $LN15@block_crea
$LN12@block_crea:
	add	rax, rsi
	lea	rcx, QWORD PTR [rax+rdi+23]
	and	rcx, -16
	sub	rcx, rdi
	mov	rax, rcx
	sub	rax, rsi
	mov	QWORD PTR [rax-8], r11
$LN15@block_crea:

; 12   : 
; 13   : 	// Partition
; 14   : 	for (u32 it=0; it<(s_count-1); it++)

	mov	eax, DWORD PTR [rbx+16]
	xor	r8d, r8d
	mov	QWORD PTR [rbx+32], rcx
	dec	eax
	je	SHORT $LN1@block_crea
	npad	1
$LL3@block_crea:

; 15   : 	{
; 16   : 		u8*	E				= list + it*s_element;

	mov	edx, DWORD PTR [rbx+12]
	mov	ecx, edx
	imul	ecx, r8d
	inc	r8d
	add	rcx, QWORD PTR [rbx+32]

; 17   : 		*access(E)			= E+s_element;

	add	rdx, rcx
	mov	QWORD PTR [rcx], rdx
	mov	eax, DWORD PTR [rbx+16]
	dec	eax
	cmp	r8d, eax
	jb	SHORT $LL3@block_crea
$LN1@block_crea:

; 18   : 	}
; 19   : 	*access	(list+(s_count-1)*s_element)	= NULL;

	mov	ecx, DWORD PTR [rbx+16]
	mov	rax, QWORD PTR [rbx+32]

; 20   : 	block_count				++;
; 21   : }

	mov	rsi, QWORD PTR [rsp+104]
	dec	ecx
	imul	ecx, DWORD PTR [rbx+12]
	mov	QWORD PTR [rcx+rax], 0
	inc	DWORD PTR [rbx+24]
	mov	rbx, QWORD PTR [rsp+96]
	add	rsp, 80					; 00000050H
	pop	rdi
	ret	0
?block_create@MEMPOOL@@AEAAXXZ ENDP			; MEMPOOL::block_create
END
