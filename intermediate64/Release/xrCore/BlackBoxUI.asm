; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.40629.0 

include listing.inc

INCLUDELIB OLDNAMES

PUBLIC	?g_stackTrace@@3PAY0BAAA@DA			; g_stackTrace
PUBLIC	?g_stackTraceCount@@3HA				; g_stackTraceCount
PUBLIC	??_C@_03LDBKEDPP@?3?$AN?6?$AA@			; `string'
EXTRN	__imp_lstrcpyA:PROC
EXTRN	__imp_OutputDebugStringA:PROC
EXTRN	__imp_GetCurrentThread:PROC
EXTRN	__imp_GetThreadContext:PROC
?g_stackTrace@@3PAY0BAAA@DA DB 064000H DUP (?)		; g_stackTrace
?g_stackTraceCount@@3HA DD 01H DUP (?)			; g_stackTraceCount
_BSS	ENDS
;	COMDAT ??_C@_03LDBKEDPP@?3?$AN?6?$AA@
CONST	SEGMENT
??_C@_03LDBKEDPP@?3?$AN?6?$AA@ DB ':', 0dH, 0aH, 00H	; `string'
PI_MUL_2 DD	040c90fdbr			; 6.28319
PUBLIC	?program_counter@@YA_KXZ			; program_counter
PUBLIC	?BuildStackTrace@@YAPEBDXZ			; BuildStackTrace
PUBLIC	?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z ; BuildStackTrace
_Tuple_alloc DB	01H DUP (?)
	ALIGN	4

ignore	DB	01H DUP (?)
	ALIGN	4

allocator_arg DB 01H DUP (?)
	ALIGN	4

piecewise_construct DB 01H DUP (?)
_BSS	ENDS
pdata	SEGMENT
$pdata$?BuildStackTrace@@YAPEBDXZ DD imagerel $LN5
	DD	imagerel $LN5+106
	DD	imagerel $unwind$?BuildStackTrace@@YAPEBDXZ
$pdata$?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z DD imagerel $LN18
	DD	imagerel $LN18+359
	DD	imagerel $unwind$?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z
xdata	SEGMENT
$unwind$?BuildStackTrace@@YAPEBDXZ DD 020701H
	DD	0a10107H
$unwind$?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z DD 040a01H
	DD	06340aH
	DD	07006320aH
; Function compile flags: /Ogtpy
; File c:\users\nummer\documents\github\olr-3.0\src\xray\xrcore\blackbox\blackboxui.cpp
_TEXT	SEGMENT
g_BlackBoxUIExPtrs$ = 48
?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z PROC	; BuildStackTrace

; 13   : {

$LN18:
	mov	QWORD PTR [rsp+8], rbx
	push	rdi
	sub	rsp, 32					; 00000020H
	mov	rbx, rcx

; 14   : 	FillMemory(g_stackTrace[0], MAX_STACK_TRACE * LINE_STACK_TRACE, 0);

	lea	rdi, OFFSET FLAT:?g_stackTrace@@3PAY0BAAA@DA ; g_stackTrace
	xor	edx, edx
	mov	rcx, rdi
	mov	r8d, 409600				; 00064000H
	call	QWORD PTR ?Memory@@3VxrMemory@@A+16

; 15   : 
; 16   : 	const TCHAR* traceDump = 
; 17   : 		GetFirstStackTraceString( GSTSO_MODULE | GSTSO_SYMBOL | GSTSO_SRCLINE | GSTSO_PARAMS,
; 18   : 									g_BlackBoxUIExPtrs );

	mov	rdx, rbx
	mov	ecx, 15
	call	GetFirstStackTraceString

; 19   : 	g_stackTraceCount = 0;

	xor	r8d, r8d
	mov	DWORD PTR ?g_stackTraceCount@@3HA, r8d	; g_stackTraceCount
	npad	4
$LL4@BuildStack:

; 20   : 
; 21   : 	int incr = 85;
; 22   : 	
; 23   : 	while (g_stackTraceCount < MAX_STACK_TRACE && traceDump) {

	test	rax, rax
	je	$LN3@BuildStack

; 24   : 	
; 25   : 		int				length = strlen(traceDump);

	or	rcx, -1
	npad	3
$LL16@BuildStack:
	inc	rcx
	cmp	BYTE PTR [rax+rcx], 0
	jne	SHORT $LL16@BuildStack

; 26   : 		if (length < 4096)

	cmp	ecx, 4096				; 00001000H
	jge	SHORT $LN2@BuildStack

; 27   : 			lstrcpy(g_stackTrace[g_stackTraceCount], traceDump);

	movsxd	rcx, r8d
	mov	rdx, rax
	shl	rcx, 12
	add	rcx, rdi
	call	QWORD PTR __imp_lstrcpyA

; 28   : 		else {

	mov	r8d, DWORD PTR ?g_stackTraceCount@@3HA	; g_stackTraceCount
	jmp	$LN1@BuildStack
$LN2@BuildStack:

; 29   : 			memcpy(g_stackTrace[g_stackTraceCount], traceDump, 4092);

	movsxd	r9, r8d
	mov	ecx, 31
	shl	r9, 12
	lea	rdx, QWORD PTR [r9+rdi]
$LL15@BuildStack:
	movups	xmm0, XMMWORD PTR [rax]
	lea	rdx, QWORD PTR [rdx+128]
	lea	rax, QWORD PTR [rax+128]
	movups	XMMWORD PTR [rdx-128], xmm0
	movups	xmm1, XMMWORD PTR [rax-112]
	movups	XMMWORD PTR [rdx-112], xmm1
	movups	xmm0, XMMWORD PTR [rax-96]
	movups	XMMWORD PTR [rdx-96], xmm0
	movups	xmm1, XMMWORD PTR [rax-80]
	movups	XMMWORD PTR [rdx-80], xmm1
	movups	xmm0, XMMWORD PTR [rax-64]
	movups	XMMWORD PTR [rdx-64], xmm0
	movups	xmm1, XMMWORD PTR [rax-48]
	movups	XMMWORD PTR [rdx-48], xmm1
	movups	xmm0, XMMWORD PTR [rax-32]
	movups	XMMWORD PTR [rdx-32], xmm0
	movups	xmm1, XMMWORD PTR [rax-16]
	movups	XMMWORD PTR [rdx-16], xmm1
	dec	rcx
	jne	SHORT $LL15@BuildStack
	movups	xmm0, XMMWORD PTR [rax]
	movups	XMMWORD PTR [rdx], xmm0
	movups	xmm1, XMMWORD PTR [rax+16]
	movups	XMMWORD PTR [rdx+16], xmm1
	movups	xmm0, XMMWORD PTR [rax+32]
	movups	XMMWORD PTR [rdx+32], xmm0
	movups	xmm1, XMMWORD PTR [rax+48]
	movups	XMMWORD PTR [rdx+48], xmm1
	movups	xmm0, XMMWORD PTR [rax+64]
	movups	XMMWORD PTR [rdx+64], xmm0
	movups	xmm1, XMMWORD PTR [rax+80]
	movups	XMMWORD PTR [rdx+80], xmm1
	movups	xmm0, XMMWORD PTR [rax+96]
	movups	XMMWORD PTR [rdx+96], xmm0
	mov	rcx, QWORD PTR [rax+112]
	mov	QWORD PTR [rdx+112], rcx
	mov	ecx, DWORD PTR [rax+120]

; 30   : 			char		*i = g_stackTrace[g_stackTraceCount] + 4092;

	lea	rax, QWORD PTR [r9+rdi]
	mov	DWORD PTR [rdx+120], ecx

; 31   : 			*i++ = '.';

	mov	DWORD PTR [rax+4092], 3026478		; 002e2e2eH
$LN1@BuildStack:

; 32   : 			*i++ = '.';
; 33   : 			*i++ = '.';
; 34   : 			*i = 0;
; 35   : 		}
; 36   : 
; 37   : 		g_stackTraceCount++;

	inc	r8d

; 38   : 	
; 39   : 		incr += 2;
; 40   : 		traceDump = GetNextStackTraceString( GSTSO_MODULE | GSTSO_SYMBOL | GSTSO_SRCLINE | GSTSO_PARAMS,
; 41   : 			g_BlackBoxUIExPtrs );

	mov	rdx, rbx
	mov	ecx, 15
	mov	DWORD PTR ?g_stackTraceCount@@3HA, r8d	; g_stackTraceCount
	call	GetNextStackTraceString
	mov	r8d, DWORD PTR ?g_stackTraceCount@@3HA	; g_stackTraceCount
	cmp	r8d, 100				; 00000064H
	jl	$LL4@BuildStack
$LN3@BuildStack:

; 42   : 	}
; 43   : 		
; 44   : }

	mov	rbx, QWORD PTR [rsp+48]
	add	rsp, 32					; 00000020H
	pop	rdi
	ret	0
?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z ENDP	; BuildStackTrace
_TEXT	ENDS
; Function compile flags: /Ogtpy
; File c:\users\nummer\documents\github\olr-3.0\src\xray\xrcore\blackbox\blackboxui.cpp
_TEXT	SEGMENT
ex_ptrs$ = 32
context$ = 48
?BuildStackTrace@@YAPEBDXZ PROC				; BuildStackTrace

; 75   : {	

$LN5:
	sub	rsp, 1288				; 00000508H

; 76   :     CONTEXT					context;
; 77   : 	context.ContextFlags	= CONTEXT_FULL;

	mov	DWORD PTR context$[rsp+48], 1048587	; 0010000bH

; 78   : 
; 79   : #ifdef _EDITOR
; 80   :     DWORD                   *EBP = &context.Ebp;
; 81   :     DWORD                   *ESP = &context.Esp;
; 82   : #endif // _EDITOR
; 83   : 
; 84   : 	if (!GetThreadContext(GetCurrentThread(),&context))

	call	QWORD PTR __imp_GetCurrentThread
	lea	rdx, QWORD PTR context$[rsp]
	mov	rcx, rax
	call	QWORD PTR __imp_GetThreadContext
	test	eax, eax
	jne	SHORT $LN1@BuildStack

; 85   : 		return NULL;

	xor	eax, eax

; 112  : }

	add	rsp, 1288				; 00000508H
	ret	0
$LN1@BuildStack:

; 86   : 
; 87   : #ifdef _WIN64
; 88   : 	context.Rip				= program_counter();

	call	?program_counter@@YA_KXZ		; program_counter

; 89   : #else
; 90   : 	context.Eip				= program_counter();
; 91   : #endif
; 92   : #ifndef _EDITOR
; 93   : #	ifdef _WIN64
; 94   : //	__asm					mov context.Rbp, ebp
; 95   : //	__asm					mov context.Rsp, esp
; 96   : #	else
; 97   : 	__asm					mov context.Ebp, ebp
; 98   : 	__asm					mov context.Esp, esp
; 99   : #	endif
; 100  : #else // _EDITOR
; 101  : 	__asm					mov EBP, ebp
; 102  : 	__asm					mov ESP, esp
; 103  : #endif // _EDITOR
; 104  : 
; 105  : 	EXCEPTION_POINTERS		ex_ptrs;
; 106  : 	ex_ptrs.ContextRecord	= &context;
; 107  : 	ex_ptrs.ExceptionRecord	= 0;
; 108  : 
; 109  : 	BuildStackTrace			(&ex_ptrs);

	lea	rcx, QWORD PTR ex_ptrs$[rsp]
	mov	QWORD PTR ex_ptrs$[rsp], 0
	mov	QWORD PTR context$[rsp+248], rax
	lea	rax, QWORD PTR context$[rsp]
	mov	QWORD PTR ex_ptrs$[rsp+8], rax
	call	?BuildStackTrace@@YAXPEAU_EXCEPTION_POINTERS@@@Z ; BuildStackTrace

; 110  : 
; 111  : 	return g_stackTrace[0];

	lea	rax, OFFSET FLAT:?g_stackTrace@@3PAY0BAAA@DA ; g_stackTrace

; 112  : }

	add	rsp, 1288				; 00000508H
	ret	0
?BuildStackTrace@@YAPEBDXZ ENDP				; BuildStackTrace
_TEXT	ENDS
; Function compile flags: /Ogtpy
; File c:\users\nummer\documents\github\olr-3.0\src\xray\xrcore\blackbox\blackboxui.cpp
_TEXT	SEGMENT
__$ReturnAddr$ = 0
?program_counter@@YA_KXZ PROC				; program_counter

; 68   : 		return (DWORD_PTR)_ReturnAddress();

	mov	rax, QWORD PTR __$ReturnAddr$[rsp]

; 69   : 	}

	ret	0
?program_counter@@YA_KXZ ENDP				; program_counter
_TEXT	ENDS
END
