; Listing generated by Microsoft (R) Optimizing Compiler Version 16.00.40219.01 

include listing.inc

INCLUDELIB OLDNAMES

PUBLIC	?construct@CFileStreamReader@@UEAAXPEBDAEBI@Z	; CFileStreamReader::construct
PUBLIC	?destroy@CFileStreamReader@@UEAAXXZ		; CFileStreamReader::destroy
PI_MUL_2 DD	040c90fdbr			; 6.28319
pdata	SEGMENT
$pdata$?construct@CFileStreamReader@@UEAAXPEBDAEBI@Z DD imagerel $LN23
	DD	imagerel $LN23+282
	DD	imagerel $unwind$?construct@CFileStreamReader@@UEAAXPEBDAEBI@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?construct@CFileStreamReader@@UEAAXPEBDAEBI@Z DD 081401H
	DD	0c6414H
	DD	0b5414H
	DD	0a3414H
	DD	070107214H
; Function compile flags: /Ogtpy
; File c:\users\nummer\documents\github\olr-3.0\src\xray\xrcore\file_stream_reader.cpp
xdata	ENDS
_TEXT	SEGMENT
this$ = 80
file_name$ = 88
window_size$ = 96
?construct@CFileStreamReader@@UEAAXPEBDAEBI@Z PROC	; CFileStreamReader::construct

; 5    : {

$LN23:
	mov	QWORD PTR [rsp+8], rbx
	mov	QWORD PTR [rsp+16], rbp
	mov	QWORD PTR [rsp+24], rsi
	push	rdi
	sub	rsp, 64					; 00000040H

; 6    : 	m_file_handle			=
; 7    : 		CreateFile(
; 8    : 			file_name,
; 9    : 			GENERIC_READ,
; 10   : 			FILE_SHARE_READ,
; 11   : 			0,
; 12   : 			OPEN_EXISTING,
; 13   : 			0,
; 14   : 			0
; 15   : 		);

	xor	ebp, ebp
	mov	rax, rdx
	mov	rbx, r8
	mov	rdi, rcx
	mov	QWORD PTR [rsp+48], rbp
	lea	r8d, QWORD PTR [rbp+1]
	xor	r9d, r9d
	mov	edx, -2147483648			; 80000000H
	mov	rcx, rax
	mov	DWORD PTR [rsp+40], ebp
	mov	DWORD PTR [rsp+32], 3
	call	QWORD PTR __imp_CreateFileA

; 16   : 
; 17   : 	VERIFY					(m_file_handle != INVALID_HANDLE_VALUE);
; 18   : 	u32						file_size = (u32)GetFileSize(m_file_handle,NULL);

	mov	rcx, rax
	xor	edx, edx
	mov	QWORD PTR [rdi+64], rax
	call	QWORD PTR __imp_GetFileSize

; 19   : 
; 20   : 	HANDLE					file_mapping_handle =
; 21   : 		CreateFileMapping(
; 22   : 			m_file_handle,
; 23   : 			0,
; 24   : 			PAGE_READONLY,
; 25   : 			0,
; 26   : 			0,
; 27   : 			0
; 28   : 		);

	mov	rcx, QWORD PTR [rdi+64]
	lea	r8d, QWORD PTR [rbp+2]
	xor	r9d, r9d
	xor	edx, edx
	mov	QWORD PTR [rsp+40], rbp
	mov	esi, eax
	mov	DWORD PTR [rsp+32], ebp
	call	QWORD PTR __imp_CreateFileMappingA

; 29   : 	VERIFY					(file_mapping_handle != INVALID_HANDLE_VALUE);
; 30   : 
; 31   : 	inherited::construct	(file_mapping_handle,0,file_size,file_size,window_size);

	mov	QWORD PTR [rdi+8], rax
	mov	DWORD PTR [rdi+16], ebp
	mov	DWORD PTR [rdi+20], esi
	mov	DWORD PTR [rdi+24], esi
	mov	rcx, QWORD PTR ?xr_FS@@3PEAVCLocatorAPI@@EA ; xr_FS
	mov	r11, rax
	mov	r8d, DWORD PTR [rcx+164]
	mov	ecx, DWORD PTR [rbx]
	mov	DWORD PTR [rdi+32], ebp
	cmp	ecx, r8d
	cmova	r8d, ecx
	xor	edx, edx
	xor	eax, eax
	mov	DWORD PTR [rdi+28], r8d
	mov	rcx, QWORD PTR ?xr_FS@@3PEAVCLocatorAPI@@EA ; xr_FS
	mov	r9d, DWORD PTR [rcx+164]
	div	r9d
	xor	edx, edx
	mov	ebx, eax
	mov	eax, r8d
	div	r9d
	imul	ebx, r9d
	test	edx, edx
	je	SHORT $LN14@construct@2
	inc	eax
$LN14@construct@2:
	imul	eax, r9d
	mov	rcx, r11
	mov	r9d, ebx
	cmp	eax, esi
	cmova	eax, esi
	xor	r8d, r8d
	sub	eax, ebx
	lea	edx, QWORD PTR [r8+4]
	mov	DWORD PTR [rdi+36], eax
	mov	QWORD PTR [rsp+32], rax
	call	QWORD PTR __imp_MapViewOfFile

; 32   : }

	mov	rbp, QWORD PTR [rsp+88]
	mov	rsi, QWORD PTR [rsp+96]
	neg	ebx
	sub	DWORD PTR [rdi+36], ebx
	mov	ecx, ebx
	mov	rbx, QWORD PTR [rsp+80]
	mov	QWORD PTR [rdi+40], rax
	add	rax, rcx
	mov	QWORD PTR [rdi+56], rax
	mov	QWORD PTR [rdi+48], rax
	add	rsp, 64					; 00000040H
	pop	rdi
	ret	0
?construct@CFileStreamReader@@UEAAXPEBDAEBI@Z ENDP	; CFileStreamReader::construct
pdata	SEGMENT
$pdata$?destroy@CFileStreamReader@@UEAAXXZ DD imagerel $LN9
	DD	imagerel $LN9+57
	DD	imagerel $unwind$?destroy@CFileStreamReader@@UEAAXXZ
pdata	ENDS
xdata	SEGMENT
$unwind$?destroy@CFileStreamReader@@UEAAXXZ DD 040a01H
	DD	06340aH
	DD	07006320aH
; Function compile flags: /Ogtpy
xdata	ENDS
_TEXT	SEGMENT
this$ = 48
?destroy@CFileStreamReader@@UEAAXXZ PROC		; CFileStreamReader::destroy

; 35   : {

$LN9:
	mov	QWORD PTR [rsp+8], rbx
	push	rdi
	sub	rsp, 32					; 00000020H

; 36   : 	HANDLE					file_mapping_handle = this->file_mapping_handle();

	mov	rbx, QWORD PTR [rcx+8]
	mov	rdi, rcx

; 37   : 	inherited::destroy		();

	mov	rcx, QWORD PTR [rcx+40]
	call	QWORD PTR __imp_UnmapViewOfFile

; 38   : 	CloseHandle				(file_mapping_handle);

	mov	rcx, rbx
	call	QWORD PTR __imp_CloseHandle

; 39   : 	CloseHandle				(m_file_handle);

	mov	rcx, QWORD PTR [rdi+64]

; 40   : }

	mov	rbx, QWORD PTR [rsp+48]
	add	rsp, 32					; 00000020H
	pop	rdi
	rex_jmp	QWORD PTR __imp_CloseHandle
?destroy@CFileStreamReader@@UEAAXXZ ENDP		; CFileStreamReader::destroy
END
